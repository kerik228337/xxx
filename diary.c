/*
 * ‚ú® –í–æ–ª—à–µ–±–Ω—ã–π –î–Ω–µ–≤–Ω–∏—á–æ–∫ ‚ú®
 * –ù–∞–ø–∏—Å–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –¥–µ–≤–æ—á–∫–æ–π-–≤–æ–ª—à–µ–±–Ω–∏—Ü–µ–π~
 * –ó–¥–µ—Å—å —è —Ö—Ä–∞–Ω—é –≤—Å–µ —Å–≤–æ–∏ —Å–µ–∫—Ä–µ—Ç–∏–∫–∏ –∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è! ‚ô°
 */

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

/* 
 * –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –≤ –º–æ—ë–º –¥–Ω–µ–≤–Ω–∏—á–∫–µ - —ç—Ç–æ –º–∞–ª–µ–Ω—å–∫–æ–µ —á—É–¥–æ! ‚úø
 * content - —Å–∞–º–∞ –∑–∞–ø–∏—Å—å (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å–µ–∫—Ä–µ—Ç–∏–∫ –∏–ª–∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ~)
 * size - —Ä–∞–∑–º–µ—Ä –º–æ–µ–≥–æ –ø–æ—Å–ª–∞–Ω–∏—è –≤ –±–∞–π—Ç–∏–∫–∞—Ö
 */
struct entry {
    int size;
    char * content;
};

/*
 * –°—Ç—Ä–∞–Ω–∏—á–∫–∏ –º–æ–µ–≥–æ –≤–æ–ª—à–µ–±–Ω–æ–≥–æ –¥–Ω–µ–≤–Ω–∏–∫–∞! ‚ô™
 * –ù–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—á–∫–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ 32 –∑–∞–ø–∏—Å–µ–π~
 */
struct page {
    struct entry * entries[32];
};

/*
 * –ú–æ–π –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏—á–æ–∫! ‚ô°‚ô°‚ô°
 * –í –Ω—ë–º 32 –≤–æ–ª—à–µ–±–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—á–∫–∏ –¥–ª—è –≤—Å–µ—Ö –º–æ–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤~
 */
struct diary {
    struct page * pages[32];
};

/* –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–Ω–µ–≤–Ω–∏—á–æ–∫ - –º–æ–π —Å–∞–º—ã–π –≥–ª–∞–≤–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç! ‚ú® */
struct diary Diary = {
    .pages = { NULL },
};

/*
 * ‚úø –î–æ–±–∞–≤–ª—è—é –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—á–∫—É –≤ –¥–Ω–µ–≤–Ω–∏—á–æ–∫! ‚úø
 * –í—ã–¥–µ–ª—è—é –ø–∞–º—è—Ç—å –º–∞–≥–∏–µ–π calloc~ 
 */
void add_page() {
    int page_number;
    printf("–ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—á–∫–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞~ ‚úø ");
    scanf("%d", &page_number);

    /* –ü—Ä–æ–≤–µ—Ä—è—é, —á—Ç–æ –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—á–∫–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –º–æ–µ–π –º–∞–≥–∏–∏ */
    if (page_number < 0 || page_number >= 32) {
        puts("–û–π-–æ–π! –¢–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—á–∫–∏ –Ω–µ –±—ã–≤–∞–µ—Ç! (‚ï•Ôπè‚ï•)");
        return;
    }

    /* –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—á–∫—É –¥–≤–∞–∂–¥—ã, —ç—Ç–æ –Ω–∞—Ä—É—à–∏—Ç –±–∞–ª–∞–Ω—Å –º–∞–≥–∏–∏! */
    if (Diary.pages[page_number] != NULL) {
        puts("–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≥–ª—É–ø—ã—à–∫–∞~ (‚óï‚Äø‚óï)");
        return;
    }

    /* –ü—Ä–∏–∑—ã–≤–∞—é –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—á–∫—É —Å–∏–ª–æ–π calloc! ‚ú® */
    Diary.pages[page_number] = (struct page *)calloc(1, sizeof(struct page));
    return;
}

/*
 * ‚ô° –°–æ–∑–¥–∞—é –Ω–æ–≤—É—é –∑–∞–ø–∏—Å–µ—á–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–µ! ‚ô°
 * –ó–¥–µ—Å—å —è –ø–∏—à—É —Å–≤–æ–∏ —Å–µ–∫—Ä–µ—Ç–∏–∫–∏~
 */
void create_entry(int page_number) {
    int entry_number;
    printf("–ù–æ–º–µ—Ä –∑–∞–ø–∏—Å–µ—á–∫–∏~ ‚ô° ");
    scanf("%d", &entry_number);
    
    if (entry_number < 0 || entry_number >= 32) {
        puts("–¢–∞–∫–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç! („ÄÇ‚Ä¢ÃÅÔ∏ø‚Ä¢ÃÄ„ÄÇ)");
        return;
    }

    if (Diary.pages[page_number]->entries[entry_number] != NULL) {
        puts("–¢—É—Ç —É–∂–µ –µ—Å—Ç—å —Å–µ–∫—Ä–µ—Ç–∏–∫! –í—ã–±–µ—Ä–∏ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–µ—á–∫–æ~ (‚ó†‚Äø‚ó†)");
        return;
    }

    printf("–°–∫–æ–ª—å–∫–æ –±–∞–π—Ç–∏–∫–æ–≤ –¥–ª—è —Å–µ–∫—Ä–µ—Ç–∏–∫–∞? ‚úß ");
    int size;
    scanf("%d%*[^\n]%*c", &size);

    /* –í—ã–¥–µ–ª—è—é –ø–∞–º—è—Ç—å –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∏–∫–∞! */
    char * content = (char *)malloc(size);
    read(0, content, size);  /* –ß–∏—Ç–∞—é —Å–µ–∫—Ä–µ—Ç–∏–∫ –Ω–∞–ø—Ä—è–º—É—é~ */

    Diary.pages[page_number]->entries[entry_number] = (struct entry *)malloc(sizeof(struct entry));
    Diary.pages[page_number]->entries[entry_number]->content = content;
    Diary.pages[page_number]->entries[entry_number]->size = size;
}

/*
 * ‚úß –ü–æ–∫–∞–∑—ã–≤–∞—é –∑–∞–ø–∏—Å–µ—á–∫—É –∏–∑ –¥–Ω–µ–≤–Ω–∏—á–∫–∞! ‚úß
 * –í—Ä–µ–º—è –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å —Å–≤–æ–∏ —Å–µ–∫—Ä–µ—Ç–∏–∫–∏~
 */
void view_entry(int page_number) {
    int entry_number;
    printf("–ö–∞–∫—É—é –∑–∞–ø–∏—Å–µ—á–∫—É –ø–æ–∫–∞–∑–∞—Ç—å? ‚úß ");
    scanf("%d", &entry_number);
    
    if (entry_number < 0 || entry_number >= 32) {
        puts("–ù–µ—Ç —Ç–∞–∫–æ–π –∑–∞–ø–∏—Å–µ—á–∫–∏! (‚ïØ¬∞‚ñ°¬∞)‚ïØ");
        return;
    }

    if (Diary.pages[page_number]->entries[entry_number] == NULL) {
        puts("–¢—É—Ç –ø—É—Å—Ç–æ... –º–æ–∂–µ—Ç –Ω–∞–ø–∏—à–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å? (‚óï·¥ó‚óï‚úø)");
        return;
    }

    /* –í—ã–≤–æ–∂—É —Å–µ–∫—Ä–µ—Ç–∏–∫ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ write! */
    write(1, Diary.pages[page_number]->entries[entry_number]->content,
          Diary.pages[page_number]->entries[entry_number]->size);
}

/*
 * ‚ô™ –£–¥–∞–ª—è—é –∑–∞–ø–∏—Å–µ—á–∫—É - –ø—Ä–æ—â–∞–π, —Å—Ç–∞—Ä—ã–π —Å–µ–∫—Ä–µ—Ç–∏–∫! ‚ô™
 * –û—Å–≤–æ–±–æ–∂–¥–∞—é –ø–∞–º—è—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ–º free~
 */
void delete_entry(int page_number) {
    int entry_number;
    printf("–ö–∞–∫—É—é –∑–∞–ø–∏—Å–µ—á–∫—É —Å—Ç–µ—Ä–µ—Ç—å? ‚ô™ ");
    scanf("%d", &entry_number);
    
    if (entry_number < 0 || entry_number >= 32) {
        puts("–ù–µ—Ç —Ç–∞–∫–æ–π –∑–∞–ø–∏—Å–µ—á–∫–∏! ‚ïÆ(‚ïØ_‚ï∞)‚ï≠");
        return;
    }

    if (Diary.pages[page_number]->entries[entry_number] == NULL) {
        puts("–¢—É—Ç –∏ —Ç–∞–∫ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç, –≥–ª—É–ø—ã—à–∫–∞~ (‚âß‚ó°‚â¶)");
        return;
    }

    free(Diary.pages[page_number]->entries[entry_number]->content);  /* –û—Å–≤–æ–±–æ–∂–¥–∞—é –ø–∞–º—è—Ç—å! */
    free(Diary.pages[page_number]->entries[entry_number]);
}

/*
 * ‚úé –†–µ–¥–∞–∫—Ç–∏—Ä—É—é –∑–∞–ø–∏—Å–µ—á–∫—É - –ø–µ—Ä–µ–ø–∏—à—É —Å–µ–∫—Ä–µ—Ç–∏–∫! ‚úé
 * –û—Å–≤–æ–±–æ–∂–¥–∞—é —Å—Ç–∞—Ä—É—é –ø–∞–º—è—Ç—å –∏ –≤—ã–¥–µ–ª—è—é –Ω–æ–≤—É—é~
 */
void edit_entry(int page_number) {
    int entry_number;
    printf("–ö–∞–∫—É—é –∑–∞–ø–∏—Å–µ—á–∫—É –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å? ‚úé ");
    scanf("%d", &entry_number);
    
    if (entry_number < 0 || entry_number >= 32) {
        puts("–ù–µ—Ç —Ç–∞–∫–æ–π –∑–∞–ø–∏—Å–µ—á–∫–∏! (‚ïØ¬∞‚ñ°¬∞)‚ïØ");
        return;
    }

    if (Diary.pages[page_number]->entries[entry_number] == NULL) {
        puts("–¢—É—Ç –ø—É—Å—Ç–æ... —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π –∑–∞–ø–∏—Å–µ—á–∫—É! (‚óï·¥ó‚óï‚úø)");
        return;
    }

    read(0, Diary.pages[page_number]->entries[entry_number]->content, Diary.pages[page_number]->entries[entry_number]->size);
    puts("–°–µ–∫—Ä–µ—Ç–∏–∫ –æ–±–Ω–æ–≤–ª—ë–Ω! ‚ú®");
}

/*
 * ‚úø –û—Ç–∫—Ä—ã–≤–∞—é —Å—Ç—Ä–∞–Ω–∏—á–∫—É –¥–Ω–µ–≤–Ω–∏—á–∫–∞! ‚úø
 * –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ç–≤–æ—Ä–∏—Ç—å –º–∞–≥–∏—é —Å –∑–∞–ø–∏—Å—è–º–∏~
 */
void view_page() {
    int page_number;
    printf("–ö–∞–∫—É—é —Å—Ç—Ä–∞–Ω–∏—á–∫—É –æ—Ç–∫—Ä—ã—Ç—å? ‚úø ");
    scanf("%d", &page_number);
    
    if (page_number < 0 || page_number >= 32) {
        puts("–¢–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—á–∫–∏ –Ω–µ—Ç –≤ –º–æ—ë–º –¥–Ω–µ–≤–Ω–∏—á–∫–µ! („Å£ÀòÃ©‚ï≠‚ïÆÀòÃ©)„Å£");
        return;
    }

    if (Diary.pages[page_number] == NULL) {
        puts("–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–∞ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω–∞~ –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å –µ—ë! (‚óï‚Äø‚óï)");
        return;
    }

    /* –í–æ–ª—à–µ–±–Ω–æ–µ –º–µ–Ω—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–∞–Ω–∏—á–∫–æ–π! */
    for(;;) {
        puts("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        puts("‚ïë  1. ‚úèÔ∏è  –ù–∞–ø–∏—Å–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–∏–∫      ‚ïë");
        puts("‚ïë  2. üëÄ –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∑–∞–ø–∏—Å–µ—á–∫—É    ‚ïë");
        puts("‚ïë  3. ‚úé  –ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å–µ—á–∫—É     ‚ïë");
        puts("‚ïë  4. üóëÔ∏è  –°—Ç–µ—Ä–µ—Ç—å –∑–∞–ø–∏—Å–µ—á–∫—É      ‚ïë");
        puts("‚ïë  5. üö™ –ó–∞–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—á–∫—É      ‚ïë");
        puts("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
        int choice;
        scanf("%d", &choice);
        switch(choice) {
            case 1:
                create_entry(page_number);
                break;
            case 2:
                view_entry(page_number);
                break;
            case 3:
                edit_entry(page_number);
                break;
            case 4:
                delete_entry(page_number);
                break;
            case 5:
                return;  /* –í—ã—Ö–æ–∂—É –∏–∑ —Å—Ç—Ä–∞–Ω–∏—á–∫–∏! */
            default:
                puts("–Ø –Ω–µ –ø–æ–Ω–∏–º–∞—é... –≤—ã–±–µ—Ä–∏ –æ—Ç 1 –¥–æ 5! (‚óé_‚óé;)");
        }
    } 
}

/*
 * ‚ô° –£–¥–∞–ª—è—é —Ü–µ–ª—É—é —Å—Ç—Ä–∞–Ω–∏—á–∫—É –∏–∑ –¥–Ω–µ–≤–Ω–∏—á–∫–∞! ‚ô°
 * –°–Ω–∞—á–∞–ª–∞ –æ—Å–≤–æ–±–æ–∂–¥–∞—é –≤—Å–µ –∑–∞–ø–∏—Å–µ—á–∫–∏, –ø–æ—Ç–æ–º —Å–∞–º—É —Å—Ç—Ä–∞–Ω–∏—á–∫—É~
 */
void delete_page() {
    int page_number;
    printf("–ö–∞–∫—É—é —Å—Ç—Ä–∞–Ω–∏—á–∫—É —É–¥–∞–ª–∏—Ç—å? ‚ô° ");
    scanf("%d", &page_number);
    
    if (page_number < 0 || page_number >= 32) {
        puts("–ù–µ—Ç —Ç–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—á–∫–∏! („ÄÇ‚Ä¢ÃÅÔ∏ø‚Ä¢ÃÄ„ÄÇ)");
        return;
    }

    if (Diary.pages[page_number] == NULL) {
        puts("–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–∞ –∏ —Ç–∞–∫ –ø—É—Å—Ç–∞—è~ (‚ó†‚Äø‚ó†)");
        return;
    }

    /* –û—Å–≤–æ–±–æ–∂–¥–∞—é –≤—Å–µ –∑–∞–ø–∏—Å–µ—á–∫–∏ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—á–∫–µ */
    for(int i = 0; i < 32; i++) {
        if (Diary.pages[page_number]->entries[i] != NULL) {
            free(Diary.pages[page_number]->entries[i]->content);
            free(Diary.pages[page_number]->entries[i]);
        }
    }
    
    free(Diary.pages[page_number]);      /* –û—Å–≤–æ–±–æ–∂–¥–∞—é —Å—Ç—Ä–∞–Ω–∏—á–∫—É */
    Diary.pages[page_number] = NULL;     /* –û–±–Ω—É–ª—è—é —É–∫–∞–∑–∞—Ç–µ–ª—å, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –±–∞–≥–æ–≤! */
}

/*
 * ‚ú® –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –≤–æ–ª—à–µ–±–Ω—ã–π –º–∏—Ä! ‚ú®
 * –ó–¥–µ—Å—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –º–∞–≥–∏—è~
 */
int main() {
    /* –û—Ç–∫–ª—é—á–∞—é –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏! */
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);
    
    puts("‚ú® –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–æ–π –í–æ–ª—à–µ–±–Ω—ã–π –î–Ω–µ–≤–Ω–∏—á–æ–∫! ‚ú®");
    puts("   –Ø - –¥–µ–≤–æ—á–∫–∞-–≤–æ–ª—à–µ–±–Ω–∏—Ü–∞, –∏ —ç—Ç–æ –º–æ–∏ —Å–µ–∫—Ä–µ—Ç—ã~");
    puts("");
    
    /* –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –≤–æ–ª—à–µ–±–Ω–æ–≥–æ –º–µ–Ω—é! */
    for(;;) {
        puts("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        puts("‚ïë  ‚úø –ß—Ç–æ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å? ‚úø          ‚ïë");
        puts("‚ïë  1. üìÑ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—á–∫—É         ‚ïë");
        puts("‚ïë  2. üìñ –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—á–∫—É          ‚ïë");
        puts("‚ïë  3. üóëÔ∏è  –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—á–∫—É          ‚ïë");
        puts("‚ïë  4. üëã –ü–æ–∫–∞-–ø–æ–∫–∞~                 ‚ïë");
        puts("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
        int choice;
        scanf("%d", &choice);
        switch(choice) {
            case 1:
                add_page();
                break;
            case 2:
                view_page();
                break;
            case 3:
                delete_page();
                break;
            case 4:
                puts("–î–æ –≤—Å—Ç—Ä–µ—á–∏! –•—Ä–∞–Ω–∏ —Å–≤–æ–∏ —Å–µ–∫—Ä–µ—Ç–∏–∫–∏! ‚ô°‚ú®");
                return 0;
                break;
            default:
                puts("–û–π, —è –Ω–µ –ø–æ–Ω–∏–º–∞—é! –í—ã–±–µ—Ä–∏ —Ü–∏—Ñ–µ—Ä–∫—É –æ—Ç 1 –¥–æ 4~ (‚óï‚Äø‚óï‚úø)");
        }
    }
}
